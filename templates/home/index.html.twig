{% extends "base.html.twig" %}
{% block body %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
            crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
    <div id="map" style="height: 555px"></div>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>

    <script>
        var mymap = L.map('map').setView([48.852969, 2.349903], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
        }).addTo(mymap);

        var markers = L.markerClusterGroup();

        // parcourir le 1er fichier json pour afficher les marqueurs
        {% for station in response %}
        var latitude = '{{ station.lat }}';
        var longitude = '{{ station.lon }}';
        var marker = L.marker([latitude, longitude]);


        // parcourir le 2ᵉ fichier json pour récupérer des informations supplémentaires
        {% for st in response2 %}
        {% if st.station_id == station.station_id %}
        marker.bindPopup('<form action="/favoritestations" method="post">' +
            "Nom : {{ station.name }}" +
            "<input type='hidden' id='nomStations' name='nomStations' value='{{ station.name }}'>" +
            " <br> Nombres vélos total : {{ st.num_bikes_available }}" +
            " <br> Nombre vélos électriques : {{ st.num_bikes_available_types[1].ebike }}" +
            "<br> Nombre de vélos mécaniques : {{ st.num_bikes_available_types[0].mechanical }}" +
            "<input type='hidden' id='idStations' name='idStations' value='{{ station.station_id }}'>" +
            "<br>" +
            '<button type="submit" id="favori" name="favori">Ajouter au favori</button></form>');
        marker.on('mouseover', function (e) {
            this.openPopup();
        });
        marker.on('click', function (e) {
            this.openPopup();
        });



        markers.addLayer(marker);
        {% endif %}
        {% endfor %}
        {% endfor %}

        mymap.addLayer(markers);

    </script>
{#    <form action="{{ ('compte') }}" method="get">#}
{#        <button class="btn btn-outline-dark" type="submit">Espace compte</button>#}
{#    </form>#}
{#    <form action="{{ ('favoritestations') }}" method="get">#}
{#        <button class="btn btn-outline-dark" type="submit">Mes stations préférées</button>#}
{#    </form>#}

{% endblock %}
